<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Live Arcade — Five Mini Games (Trails + Reels + Video)</title>
<style>
  :root{
    --ink:#eaf2ff; --mut:#9fb0d9; --g1:#71e1ff; --g2:#25c3ff; --gold:#ffd86a; --warn:#ffb3be;
    --card1:#142345; --card2:#0d1836; --line:rgba(255,255,255,.08);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--ink);
    background:
      radial-gradient(1400px 900px at 70% -10%,#1a2858 0%,#0a0f1e 55%,#05070d 100%),
      #05070d;
    font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
    display:flex; align-items:center; justify-content:center; padding:18px; overflow:hidden;
  }

  /* --- Ambient video (real source) --- */
  #bg-video{
    position:fixed; inset:0; width:100%; height:100%; object-fit:cover; z-index:-3; opacity:.28;
    filter:saturate(1.2) contrast(1.05) blur(1px);
    pointer-events:none;
  }

  /* --- Ambient particles + trails + confetti --- */
  #fx-bg, #fx-trails, #fx-confetti{position:fixed; inset:0; pointer-events:none}
  #fx-bg{z-index:-2}
  #fx-trails{z-index:-1; mix-blend-mode:screen}
  #fx-confetti{z-index:0; mix-blend-mode:screen}

  .wrap{position:relative; z-index:1; width:min(1100px,96vw);}

  header{text-align:center; margin-bottom:12px}
  h1{margin:0 0 6px; font-size:clamp(22px,5vw,36px); font-weight:900; letter-spacing:.5px; text-transform:uppercase;
     background:linear-gradient(to right,var(--g1),var(--g2)); -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent;
     text-shadow:0 0 24px rgba(113,225,255,.35)}
  p.sub{margin:0; color:var(--mut)}

  /* --- Control bar --- */
  .controlbar{
    margin-top:10px; display:flex; gap:10px; flex-wrap:wrap; justify-content:center; align-items:center;
    padding:8px 10px; border-radius:14px; background:rgba(0,0,0,.28); outline:1px solid var(--line);
  }
  .sw{display:flex; align-items:center; gap:8px; color:#d6e6ff; font-weight:700; font-size:13px}
  .sw input[type="range"]{width:160px}
  .pill{border:0; border-radius:999px; padding:8px 14px; font-weight:900; cursor:pointer;
        background:#2b2b2b; color:#fff; outline:1px solid var(--line)}
  .pill.active{background:linear-gradient(to right,var(--g1),var(--g2)); color:#061018; box-shadow:0 0 18px rgba(113,225,255,.5)}

  /* Tabs */
  .tabs{ margin-top:14px; display:flex; gap:8px; flex-wrap:wrap; justify-content:center }
  .tabBtn{ border:0; border-radius:999px; padding:8px 14px; font-weight:900; cursor:pointer;
           background:#2b2b2b; color:#fff; outline:1px solid var(--line); transition:transform .15s ease}
  .tabBtn:hover{transform:translateY(-1px)}
  .tabBtn.active{ background:linear-gradient(to right,var(--g1),var(--g2)); color:#061018; box-shadow:0 0 18px rgba(113,225,255,.5) }

  .panel{
    margin-top:12px; padding:12px; border-radius:14px; background:rgba(0,0,0,.28);
    outline:1px solid var(--line); color:var(--mut); font-size:13px
  }
  .panel .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center }
  .btn{ border:0; border-radius:12px; padding:8px 12px; font-weight:900; cursor:pointer; transition:transform .12s ease}
  .btn:active{transform:translateY(1px)}
  .ghost{ background:#2b2b2b; color:#fff; outline:1px solid var(--line) }
  .primary{ background:linear-gradient(to right,var(--g1),var(--g2)); color:#061018; box-shadow:0 8px 18px rgba(113,225,255,.35), inset 0 -3px 0 rgba(0,0,0,.35)}

  .card{
    position:relative; border-radius:22px; padding:18px; margin-top:12px;
    background:linear-gradient(180deg,var(--card1),var(--card2));
    outline:1px solid var(--line); box-shadow:0 16px 60px rgba(0,0,0,.55);
    animation:fadeUp .36s ease both
  }
  @keyframes fadeUp{ from{opacity:0; transform:translateY(8px)} to{opacity:1; transform:none} }
  .game{ display:none } .game.active{ display:block }

  /* Shared UI */
  .row.center{ display:flex; gap:10px; justify-content:center; flex-wrap:wrap }
  .code{
    display:none; margin-top:10px; text-align:center;
    font-family:ui-monospace,SFMono-Regular,Menlo,monospace; letter-spacing:.5px;
    padding:10px 12px; border-radius:12px; background:#0a0d1a; outline:1px dashed rgba(160,220,255,.35);
    min-height:38px;
  }
  .copy{ display:none; margin-top:8px; border:0; border-radius:10px; padding:8px 10px; font-weight:900; background:#2b2b2b; color:#fff }

  /* ---------- Lightning Roulette ---------- */
  .lr-layout{display:grid;gap:16px;grid-template-columns:1fr;justify-items:center}
  .lr-grid{display:grid;grid-template-columns:repeat(10, minmax(34px,1fr));gap:6px;width:min(520px,92%);justify-items:center}
  .lr-num{width:100%;padding:8px 0;border-radius:8px;text-align:center;font-weight:900;cursor:pointer;outline:1px solid var(--line); transition:transform .12s ease, box-shadow .2s}
  .lr-num:hover{transform:translateY(-1px)}
  .lr-red{background:#7a1a28} .lr-black{background:#1a1a1a} .lr-zero{background:#0b5c3b}
  .lr-num.sel{outline:2px solid rgba(113,225,255,.9);box-shadow:0 0 16px rgba(113,225,255,.5)}
  .lr-legend{font-size:12px;color:#9fb0d9}
  .lr-wheelWrap{position:relative;width:min(520px,86vw);aspect-ratio:1/1}
  .lr-wheel{position:absolute;inset:0;border-radius:50%;display:grid;place-items:center;background:
            radial-gradient(closest-side,#0e1633,#0a122a 65%,#060b1c 100%);box-shadow:
            inset 0 0 60px rgba(0,0,0,.6), 0 0 60px rgba(113,225,255,.18), 0 0 80px rgba(192,107,255,.16);overflow:hidden}
  .lr-slices{position:absolute;inset:10px;border-radius:50%}
  .lr-slice{position:absolute;left:50%;top:50%;transform-origin:0% 0%;width:50%;height:50%;clip-path:polygon(0 0,100% 0,0 100%);display:flex;align-items:center;justify-content:center;font-weight:900;font-size:11px;color:#fff;text-shadow:0 2px 8px rgba(0,0,0,.6)}
  .lr-label{transform:translate(-60%,-20%) rotate(45deg);width:60px;line-height:1.1;text-align:center}
  .lr-pin{position:absolute;top:-10px;left:50%;transform:translateX(-50%);width:0;height:0;border-left:12px solid transparent;border-right:12px solid transparent;border-bottom:18px solid #ffea9a;filter:drop-shadow(0 0 10px rgba(255,220,120,.9))}
  .lr-lightBar{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
  .lr-bolt{padding:6px 10px;border-radius:10px;background:rgba(255,230,140,.1);outline:1px solid rgba(255,230,140,.35);font-weight:900}
  .lr-flash{animation:lrflash .6s ease-in-out infinite alternate}
  @keyframes lrflash{from{box-shadow:0 0 10px rgba(255,230,140,.4)}to{box-shadow:0 0 26px rgba(255,230,140,.9)}}
  .lightning-overlay{position:absolute;inset:0;background:radial-gradient(120% 120% at 50% 50%, rgba(255,255,255,.6), rgba(255,255,255,0) 60%); opacity:0; pointer-events:none}

  /* ---------- Blackjack ---------- */
  .bj-table{border-radius:18px;background:radial-gradient(closest-side,#13325f,#0e1f43);outline:1px solid var(--line);box-shadow:inset 0 0 60px rgba(0,0,0,.6);padding:16px}
  .bj-hand{display:flex;gap:8px;min-height:100px;justify-content:center;align-items:center;margin:8px 0}
  .bj-card{width:64px;height:90px;border-radius:10px;background:radial-gradient(180px 120px at 50% -20%,#fff,#e9eefc 40%,#c8d4f3 100%);outline:2px solid #e5ecff;box-shadow:0 10px 24px rgba(0,0,0,.35);display:grid;place-items:center;font-weight:900;color:#1a2050;transform-style:preserve-3d; transition:transform .38s ease;}
  .bj-down{background:linear-gradient(180deg,#0e1a3a,#0a1329);outline:1px solid var(--line)}
  .bj-card.flip{transform:rotateY(180deg)}
  .bj-score{color:var(--gold);font-weight:900;text-shadow:0 0 10px rgba(255,216,106,.6);margin:4px 0;text-align:center}

  /* ---------- Dragon Tiger ---------- */
  .dt-arena{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .dt-side{border-radius:18px;background:radial-gradient(closest-side,#13325f,#0e1f43);outline:1px solid var(--line);box-shadow:inset 0 0 60px rgba(0,0,0,.6);padding:12px;min-height:180px;display:grid;gap:8px}
  .dt-head{display:flex;justify-content:space-between;align-items:center}
  .dt-pick{border:0;border-radius:999px;padding:8px 12px;font-weight:900;cursor:pointer;background:linear-gradient(to right,var(--g1),var(--g2));color:#061018;box-shadow:0 0 18px rgba(113,225,255,.5), inset 0 -3px 0 rgba(0,0,0,.35)}
  .dt-card{width:82px;height:112px;border-radius:12px;background:radial-gradient(200px 120px at 50% -20%,#fff,#e9eefc 40%,#c8d4f3 100%);outline:2px solid #e5ecff;box-shadow:0 10px 24px rgba(0,0,0,.35);display:grid;place-items:center;font-weight:900;color:#1a2050;margin:6px auto; transform-style:preserve-3d; transition:transform .36s}
  .dt-down{background:linear-gradient(180deg,#0e1a3a,#0a1329);outline:1px solid var(--line)}
  .dt-flip{transform:rotateY(180deg)}
  .dt-status{text-align:center;color:var(--gold);font-weight:900;text-shadow:0 0 10px rgba(255,216,106,.6);margin-top:8px}

  /* ---------- Craps ---------- */
  .cr-felt{border-radius:18px;background:radial-gradient(closest-side,#13325f,#0e1f43);outline:1px solid var(--line);box-shadow:inset 0 0 60px rgba(0,0,0,.6);padding:16px;text-align:center}
  .cr-dice{display:flex;gap:12px;justify-content:center;margin:12px 0}
  .cr-die{width:64px;height:64px;background:#fff;border-radius:10px;display:grid;place-items:center;color:#111;font-weight:900;box-shadow:0 8px 20px rgba(0,0,0,.35); transition:transform .2s}
  .shake{animation:shake .4s ease}
  @keyframes shake{10%{transform:translate(-2px,-2px) rotate(-3deg)} 30%{transform:translate(3px,2px) rotate(3deg)} 50%{transform:translate(-3px,1px) rotate(-2deg)} 70%{transform:translate(2px,-1px) rotate(2deg)} 100%{transform:none}}
  .cr-status{color:var(--gold);font-weight:900;text-shadow:0 0 10px rgba(255,216,106,.6);margin-top:6px}

  /* ---------- Baccarat Squeeze ---------- */
  .bc-felt{border-radius:18px;background:radial-gradient(closest-side,#13325f,#0e1f43);outline:1px solid var(--line);box-shadow:inset 0 0 60px rgba(0,0,0,.6);padding:14px}
  .bc-row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:center;margin-bottom:8px}
  .bc-zone{display:grid;gap:8px;grid-template-columns:1fr 1fr;align-items:center}
  .bc-side{border-radius:16px;background:rgba(0,0,0,.25);padding:12px;outline:1px solid var(--line)}
  .bc-side h3{margin:0 0 6px;font-size:14px;display:flex;justify-content:space-between;align-items:center}
  .bc-hand{display:flex;gap:10px;justify-content:center;min-height:120px}
  .bc-card{position:relative;width:86px;height:120px;border-radius:12px;background:radial-gradient(220px 140px at 50% -20%,#fff,#e9eefc 40%,#c8d4f3 100%);outline:2px solid #e5ecff;box-shadow:0 10px 24px rgba(0,0,0,.35);display:grid;place-items:center;font-weight:900;color:#1a2050;overflow:hidden; transform-style:preserve-3d; transition:filter .2s, transform .36s}
  .bc-face{filter:blur(3px)} .bc-card.show .bc-face{filter:none;transition:filter .2s}
  .bc-cover{position:absolute;inset:0;pointer-events:none;background:linear-gradient(180deg,rgba(10,16,30,.75),rgba(10,16,30,.55));}
  .bc-corners{position:absolute;inset:0}
  .bc-corner{position:absolute;width:40px;height:40px;background:rgba(10,16,30,.92);outline:1px solid rgba(255,255,255,.06);opacity:.95}
  .bc-corner.off{opacity:0;pointer-events:none;transition:opacity .15s}
  .bc-card.show .bc-corners{display:none}
  .bc-tl{left:0;top:0;clip-path:polygon(0 0,100% 0,0 100%)} .bc-tr{right:0;top:0;clip-path:polygon(0 0,100% 0,100% 100%)} 
  .bc-bl{left:0;bottom:0;clip-path:polygon(0 0,100% 100%,0 100%)} .bc-br{right:0;bottom:0;clip-path:polygon(100% 0,100% 100%,0 100%)}
  .bc-score{text-align:center;color:var(--gold);font-weight:900;text-shadow:0 0 10px rgba(255,216,106,.6);margin-top:6px}
  .bc-status{text-align:center;margin-top:10px;color:#9fb0d9}

  .badge-win{color:#041a0f; background:#aef7c1; border-radius:999px; padding:.2em .6em; font-weight:900}
  .badge-lose{color:#2b0b11; background:#ffb3be; border-radius:999px; padding:.2em .6em; font-weight:900}
</style>
</head>
<body>
  <!-- Real ambient background video (free neon loop). Swap URL anytime. -->
  <video id="bg-video" autoplay loop muted playsinline preload="auto">
    <source src="https://cdn.coverr.co/videos/coverr-looped-lights-720p.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>

  <canvas id="fx-bg"></canvas>
  <canvas id="fx-trails"></canvas>
  <canvas id="fx-confetti"></canvas>

  <div class="wrap">
    <header>
      <h1>Live Arcade</h1>
      <p class="sub">Pick a game tab. Sounds are <b>opt-in</b>. Ambient video can be toggled. Your first action locks you to <b>Live</b> (stored in <code>localStorage</code>).</p>
    </header>

    <div class="controlbar">
      <button class="pill" id="sfxToggle">Enable SFX</button>
      <div class="sw"><label for="sfxVol">SFX</label><input id="sfxVol" type="range" min="0" max="100" value="75"></div>
      <button class="pill" id="musicToggle">Play Music</button>
      <div class="sw"><label for="musVol">Music</label><input id="musVol" type="range" min="0" max="100" value="35"></div>
      <button class="pill" id="muteAll">Mute All</button>
      <button class="pill active" id="videoToggle">Video On</button>
    </div>

    <div class="tabs" id="tabs">
      <button class="tabBtn active" data-tab="lightning">⚡ Lightning Roulette</button>
      <button class="tabBtn" data-tab="blackjack">🂡 Blackjack</button>
      <button class="tabBtn" data-tab="dragontiger">🐉🐯 Dragon Tiger</button>
      <button class="tabBtn" data-tab="craps">🎲 Craps</button>
      <button class="tabBtn" data-tab="baccarat">🂢 Baccarat Squeeze</button>
    </div>

    <div class="panel">
      <div class="row">
        <div><b>Realm lock:</b> <span id="realmState">—</span></div>
        <button class="btn ghost" id="clearLock">Reset realm lock</button>
        <button class="btn ghost" id="clearClaims">Reset all claims</button>
      </div>
      <div style="margin-top:6px">Testing only — clears <code>localStorage</code> keys for these games.</div>
    </div>

    <!-- LIGHTNING -->
    <section class="card game active" id="game-lightning">
      <h2 style="margin:0 0 8px;font-size:20px;font-weight:900;text-transform:uppercase">Lightning Roulette Pick</h2>
      <p class="sub" style="margin:0 0 12px">Pick one number (0–36). Lightning strikes before spin. Exact hit wins; lightning hit pays premium voucher.</p>

      <div class="lr-layout">
        <div class="lr-grid" id="lr-pickGrid"></div>
        <div class="lr-legend">Tap to choose exactly one number.</div>

        <div class="lr-lightBar" id="lr-lightBar"></div>

        <div class="lr-wheelWrap">
          <div class="lr-pin"></div>
          <div class="lr-wheel">
            <div class="lr-slices" id="lr-slices"></div>
            <div class="lightning-overlay" id="lr-flashFx"></div>
          </div>
        </div>

        <div class="row center">
          <button class="btn primary" id="lr-spinBtn" disabled>Spin</button>
        </div>

        <div class="code" id="lr-codeBox">LIVE-LIGHT-XXXX</div>
        <button class="copy" id="lr-copyBtn">Copy Code</button>
      </div>
    </section>

    <!-- BLACKJACK -->
    <section class="card game" id="game-blackjack">
      <h2 style="margin:0 0 8px;font-size:20px;font-weight:900;text-transform:uppercase">Mini Blackjack</h2>
      <p class="sub" style="margin:0 0 12px">Beat the dealer to reveal your voucher.</p>

      <div class="bj-table">
        <div class="bj-score" id="bj-status">Tap Deal</div>

        <div style="text-align:center;font-weight:900;margin-top:4px">Dealer</div>
        <div class="bj-hand" id="bj-dealerHand"></div>
        <div class="bj-score" id="bj-dealerScore">—</div>

        <div style="text-align:center;font-weight:900;margin-top:8px">You</div>
        <div class="bj-hand" id="bj-playerHand"></div>
        <div class="bj-score" id="bj-playerScore">—</div>

        <div class="row center" style="margin-top:10px">
          <button class="btn primary" id="bj-dealBtn">Deal</button>
          <button class="btn primary" id="bj-hitBtn" disabled>Hit</button>
          <button class="btn ghost"   id="bj-standBtn" disabled>Stand</button>
        </div>

        <div class="code" id="bj-codeBox">LIVE-BJ-XXXX</div>
        <button class="copy" id="bj-copyBtn">Copy Code</button>
      </div>
    </section>

    <!-- DRAGON TIGER -->
    <section class="card game" id="game-dragontiger">
      <h2 style="margin:0 0 8px;font-size:20px;font-weight:900;text-transform:uppercase">Dragon Tiger</h2>
      <p class="sub" style="margin:0 0 12px">Pick a side, draw 1 card each. Highest rank wins (A low).</p>

      <div class="dt-arena">
        <div class="dt-side">
          <div class="dt-head"><b>🐉 Dragon</b><button class="dt-pick" id="dt-pick-d">Pick Dragon</button></div>
          <div class="dt-card dt-down" id="dt-dCard"></div>
        </div>
        <div class="dt-side">
          <div class="dt-head"><b>🐯 Tiger</b><button class="dt-pick" id="dt-pick-t">Pick Tiger</button></div>
          <div class="dt-card dt-down" id="dt-tCard"></div>
        </div>
      </div>

      <div class="dt-status" id="dt-status">Choose your side</div>
      <div class="code" id="dt-codeBox">LIVE-DT-XXXX</div>
      <button class="copy" id="dt-copyBtn">Copy Code</button>
    </section>

    <!-- CRAPS -->
    <section class="card game" id="game-craps">
      <h2 style="margin:0 0 8px;font-size:20px;font-weight:900;text-transform:uppercase">Mini Craps — Pass Line</h2>
      <p class="sub" style="margin:0 0 12px">Choose <b>Pass</b> or <b>Don’t Pass</b>. Come-out → point cycle.</p>

      <div class="cr-felt">
        <div class="row center">
          <button class="btn primary" id="cr-betPass">Bet Pass</button>
          <button class="btn ghost"   id="cr-betDont">Bet Don’t Pass</button>
        </div>

        <div class="cr-dice"><div class="cr-die" id="cr-d1">–</div><div class="cr-die" id="cr-d2">–</div></div>
        <div class="row center"><button class="btn primary" id="cr-rollBtn" disabled>Roll</button></div>
        <div class="cr-status" id="cr-status">Place your bet</div>

        <div class="code" id="cr-codeBox">LIVE-CRAPS-XXXX</div>
        <button class="copy" id="cr-copyBtn">Copy Code</button>
      </div>
    </section>

    <!-- BACCARAT SQUEEZE -->
    <section class="card game" id="game-baccarat">
      <h2 style="margin:0 0 8px;font-size:20px;font-weight:900;text-transform:uppercase">Baccarat Squeeze (Lite)</h2>
      <p class="sub" style="margin:0 0 12px">Pick a side, then “squeeze” the corners to reveal. Highest total (mod 10) wins.</p>

      <div class="bc-felt">
        <div class="bc-row">
          <button class="btn primary" id="bc-betPlayer">Bet Player</button>
          <button class="btn ghost"   id="bc-betBanker">Bet Banker</button>
          <button class="btn primary" id="bc-dealBtn" disabled>Deal</button>
        </div>

        <div class="bc-zone">
          <div class="bc-side">
            <h3>🂡 Player <span id="bc-pScore">—</span></h3>
            <div class="bc-hand" id="bc-pHand"></div>
          </div>
          <div class="bc-side">
            <h3>🂱 Banker <span id="bc-bScore">—</span></h3>
            <div class="bc-hand" id="bc-bHand"></div>
          </div>
        </div>

        <div class="bc-score" id="bc-result">Place your bet</div>
        <div class="bc-status" id="bc-hint">Tap each card’s corners to peel. Reveal at least 3 corners to flip.</div>

        <div class="code" id="bc-codeBox">LIVE-BAC-XXXX</div>
        <button class="copy" id="bc-copyBtn">Copy Code</button>
      </div>
    </section>
  </div>

<script>
/* ========= Canvas sizing ========= */
const bg = document.getElementById('fx-bg');
const trails = document.getElementById('fx-trails');
const confetti = document.getElementById('fx-confetti');
const ctx = bg.getContext('2d'), tfx = trails.getContext('2d'), cfx = confetti.getContext('2d');
function sizeCanv(){ [bg,trails,confetti].forEach(c=>{ c.width=innerWidth; c.height=innerHeight; }); }
addEventListener('resize', sizeCanv); sizeCanv();

/* ========= Ambient particles ========= */
const P = Array.from({length:90},()=>({
  x: Math.random()*bg.width, y: Math.random()*bg.height,
  r: Math.random()*1.8+0.6, s: Math.random()*0.6+0.2
}));
(function tickBg(){
  ctx.clearRect(0,0,bg.width,bg.height);
  ctx.fillStyle='rgba(120,190,255,.8)';
  P.forEach(p=>{
    p.y+=p.s; p.x+=Math.sin((p.y+p.x)*0.002)*0.2;
    if(p.y>bg.height+10){ p.y=-10; p.x=Math.random()*bg.width; }
    ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill();
  });
  requestAnimationFrame(tickBg);
})();

/* ========= Glow trails (cursor/touch) ========= */
const trailPts=[];
function addPoint(x,y){
  trailPts.push({x,y,life:1, vx:(Math.random()-.5)*1.2, vy:(Math.random()-.5)*1.2});
  if(trailPts.length>180) trailPts.shift();
}
function drawTrails(){
  tfx.clearRect(0,0,trails.width,trails.height);
  trailPts.forEach(p=>{
    p.x+=p.vx; p.y+=p.vy; p.life*=0.96;
    const g= tfx.createRadialGradient(p.x,p.y,0,p.x,p.y,24);
    g.addColorStop(0,`rgba(140,220,255,${0.35*p.life})`);
    g.addColorStop(1,`rgba(140,220,255,0)`);
    tfx.fillStyle=g; tfx.beginPath(); tfx.arc(p.x,p.y,24,0,Math.PI*2); tfx.fill();
  });
  requestAnimationFrame(drawTrails);
}
drawTrails();
addEventListener('mousemove',e=>addPoint(e.clientX,e.clientY));
addEventListener('touchmove',e=>{ const t=e.touches[0]; if(t) addPoint(t.clientX,t.clientY); }, {passive:true});
addEventListener('touchstart',e=>{ const t=e.touches[0]; if(t) for(let i=0;i<12;i++) addPoint(t.clientX,t.clientY); }, {passive:true});

/* ========= Confetti burst ========= */
function confettiBurst(cx,cy){
  const N=120, parts=[];
  for(let i=0;i<N;i++){
    const a=Math.random()*Math.PI*2, v=Math.random()*4+2, sz=Math.random()*3+2;
    parts.push({x:cx,y:cy, vx:Math.cos(a)*v, vy:Math.sin(a)*v, g:.06, life:120, sz});
  }
  let alive=true;
  (function step(){
    if(!alive) return;
    cfx.clearRect(0,0,confetti.width,confetti.height);
    parts.forEach(p=>{
      p.vy+=p.g; p.x+=p.vx; p.y+=p.vy; p.life--;
    });
    parts.forEach(p=>{
      cfx.fillStyle=`rgba(${200+Math.random()*55|0},${120+Math.random()*135|0},255,${Math.max(0,p.life/120)})`;
      cfx.fillRect(p.x,p.y,p.sz,p.sz*0.6);
    });
    if(parts.every(p=>p.life<=0)){ alive=false; cfx.clearRect(0,0,confetti.width,confetti.height); return; }
    requestAnimationFrame(step);
  })();
}

/* ========= Realm helpers ========= */
function getChoice(){ try{return localStorage.getItem('realm_choice')}catch(e){return null} }
function setChoice(v){ try{localStorage.setItem('realm_choice', v)}catch(e){} }
const realmState = document.getElementById('realmState');
function updateRealmLabel(){ const cur = getChoice(); realmState.textContent = cur ? `Locked to: ${cur.toUpperCase()}` : 'No lock'; }
updateRealmLabel();
function ensureLiveLock(){ if(getChoice()!=='live'){ setChoice('live'); updateRealmLabel(); } }

/* ========= Audio (SFX + simple music) ========= */
let AC=null, sfxOn=false, musicOn=false, masterGain=null, sfxGain=null, musicGain=null, musicTimer=null;
function ensureAC(){
  if(AC) return;
  AC = new (window.AudioContext||window.webkitAudioContext)();
  masterGain = AC.createGain(); masterGain.gain.value=1; masterGain.connect(AC.destination);
  sfxGain = AC.createGain(); sfxGain.gain.value=0.75; sfxGain.connect(masterGain);
  musicGain = AC.createGain(); musicGain.gain.value=0.35; musicGain.connect(masterGain);
}
function envOsc({type='sine', freq=440, dur=0.12, gain=0.08, dest=sfxGain}){
  if(!AC||!sfxOn) return;
  const o=AC.createOscillator(), g=AC.createGain();
  o.type=type; o.frequency.value=freq; g.gain.value=0; o.connect(g); g.connect(dest);
  const t=AC.currentTime; g.gain.linearRampToValueAtTime(gain, t+0.01);
  g.gain.exponentialRampToValueAtTime(0.0001, t+dur);
  o.start(t); o.stop(t+dur+0.02);
}
function clickSfx(){ envOsc({type:'square', freq:520, dur:.07, gain:.06}); }
function flipSfx(){ envOsc({type:'triangle', freq:240, dur:.12, gain:.08}); }
function tickSfx(){ envOsc({type:'square', freq:880, dur:.03, gain:.05}); }
function winSfx(){ [0,0.12,0.24].forEach((d,i)=>setTimeout(()=>envOsc({type:'sine', freq:[740,880,1040][i], dur:.18, gain:.1}), d*1000)); }
function loseSfx(){ envOsc({type:'sawtooth', freq:220, dur:.25, gain:.08}); }
function zapSfx(){ if(!AC||!sfxOn) return; const start=AC.currentTime, z=AC.createOscillator(), g=AC.createGain();
  z.type='square'; z.frequency.setValueAtTime(1200,start); z.frequency.exponentialRampToValueAtTime(80,start+0.15);
  g.gain.setValueAtTime(.12,start); g.gain.exponentialRampToValueAtTime(.0001,start+0.16);
  z.connect(g); g.connect(sfxGain); z.start(); z.stop(start+0.17);
}
function diceSfx(){ envOsc({type:'triangle', freq:300, dur:.08, gain:.07}); setTimeout(()=>envOsc({type:'triangle', freq:260, dur:.08, gain:.07}),60); }
function copySfx(){ envOsc({type:'sine', freq:940, dur:.06, gain:.06}); }

/* Simple chiptune loop */
const melody=[523,587,659,784,659,587,523,392,440,523,659,587,523];
function startMusic(){ if(!AC||musicOn) return; musicOn=true; let i=0;
  musicTimer = setInterval(()=>{ if(!musicOn) return;
    const o=AC.createOscillator(), g=AC.createGain();
    o.type='triangle'; o.frequency.value=melody[i%melody.length];
    g.gain.value=0; const t=AC.currentTime; o.connect(g); g.connect(musicGain);
    g.gain.linearRampToValueAtTime(.12,t+.02); g.gain.exponentialRampToValueAtTime(.0001,t+.28);
    o.start(t); o.stop(t+.3); i++;
  }, 300);
}
function stopMusic(){ musicOn=false; if(musicTimer){ clearInterval(musicTimer); musicTimer=null; } }

/* ========= Controls ========= */
const sfxToggle=document.getElementById('sfxToggle');
const musicToggle=document.getElementById('musicToggle');
const muteAll=document.getElementById('muteAll');
const sfxVol=document.getElementById('sfxVol');
const musVol=document.getElementById('musVol');
const videoToggle=document.getElementById('videoToggle');
const bgVideo=document.getElementById('bg-video');

sfxToggle.addEventListener('click',()=>{ ensureAC(); AC.resume(); sfxOn=!sfxOn; sfxToggle.classList.toggle('active', sfxOn); clickSfx(); });
musicToggle.addEventListener('click',()=>{ ensureAC(); AC.resume(); if(!musicOn){ startMusic(); } else { stopMusic(); } musicToggle.classList.toggle('active', musicOn); });
muteAll.addEventListener('click',()=>{ ensureAC(); const muted = masterGain.gain.value>0; masterGain.gain.value = muted ? 0 : 1; muteAll.textContent = muted ? 'Unmute All' : 'Mute All'; });
sfxVol.addEventListener('input',()=>{ ensureAC(); sfxGain.gain.value = sfxVol.value/100; });
musVol.addEventListener('input',()=>{ ensureAC(); musicGain.gain.value = musVol.value/100; });
videoToggle.addEventListener('click',()=>{
  const on = bgVideo.style.display !== 'none';
  bgVideo.style.display = on ? 'none' : 'block';
  videoToggle.textContent = on ? 'Video Off' : 'Video On';
  videoToggle.classList.toggle('active', !on);
});

/* ===== Tabs and reset ===== */
const tabs = document.getElementById('tabs');
tabs.addEventListener('click', (e)=>{
  const btn = e.target.closest('.tabBtn'); if(!btn) return;
  tabs.querySelectorAll('.tabBtn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  const tab = btn.dataset.tab;
  document.querySelectorAll('.game').forEach(g=>g.classList.remove('active'));
  document.getElementById('game-'+tab).classList.add('active');
  if(sfxOn) clickSfx();
});

document.getElementById('clearLock').addEventListener('click', ()=>{ try{localStorage.removeItem('realm_choice')}catch(e){}; updateRealmLabel(); if(sfxOn) clickSfx(); });
document.getElementById('clearClaims').addEventListener('click', ()=>{
  ['live_lightning_claimed_v1','live_blackjack_claimed_v1','live_dt_claimed_v1','live_craps_claimed_v1','live_bac_squeeze_claimed_v1'].forEach(k=>{ try{localStorage.removeItem(k)}catch(e){} });
  alert('Claims cleared for testing.');
  if(sfxOn) clickSfx();
});

/* ========= Voucher Reel Reveal ========= */
const REEL_CHARS = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
function reelReveal(codeEl, copyBtnEl, finalCode, opts={}){
  const {spinMs=900, slots=finalCode.length, group=finalCode} = opts;
  codeEl.style.display='block'; copyBtnEl.style.display='none';
  let frame=0; const step=32; // total frames
  const target=finalCode.split('');
  const timer=setInterval(()=>{
    frame++;
    const progress = Math.min(1, frame/step);
    const revealIdx = Math.floor(progress*slots);
    // Build spinning string
    let out='';
    for(let i=0;i<slots;i++){
      if(i<revealIdx){ out += target[i]; }
      else{ out += REEL_CHARS[(Math.random()*REEL_CHARS.length)|0]; }
    }
    codeEl.textContent = out;
    if(sfxOn) tickSfx();
    if(progress>=1){
      clearInterval(timer);
      codeEl.textContent = group;
      copyBtnEl.style.display='inline-block';
      if(sfxOn) copySfx();
    }
  }, spinMs/step);
}

/* ========= LIGHTNING ========= */
(function(){
  const CLAIM_KEY='live_lightning_claimed_v1', CODE_STD='LIVE-LIGHT-WIN', CODE_XL='LIVE-LIGHT-XL';
  const pickGrid=document.getElementById('lr-pickGrid');
  const reds=new Set([1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36]);
  const slices=document.getElementById('lr-slices'); const N=37;
  const lightBar=document.getElementById('lr-lightBar');
  const spinBtn=document.getElementById('lr-spinBtn'), codeBox=document.getElementById('lr-codeBox'), copyBtn=document.getElementById('lr-copyBtn');
  const flashFx=document.getElementById('lr-flashFx');
  let selected=null, spun=false, lightning=[];

  for(let n=0;n<=36;n++){
    const b=document.createElement('button'); b.className='lr-num ' + (n===0?'lr-zero':(reds.has(n)?'lr-red':'lr-black')); b.textContent=n;
    b.addEventListener('click',()=>{ if(spun) return; selected=n; [...pickGrid.children].forEach(x=>x.classList.remove('sel')); b.classList.add('sel'); spinBtn.disabled=false; if(sfxOn) clickSfx(); });
    pickGrid.appendChild(b);
  }
  for(let i=0;i<N;i++){
    const deg=(360/N)*i; const el=document.createElement('div'); el.className='lr-slice';
    el.style.transform=`translate(-50%,-50%) rotate(${deg}deg)`;
    const col = i===0?'#0b5c3b' : (reds.has(i)?'#7a1a28':'#1a1a1a');
    el.style.background = `linear-gradient(180deg, ${col}, #101010)`;
    el.innerHTML=`<div class="lr-label">${i}</div>`; slices.appendChild(el);
  }
  function chooseLightning(){
    const how=2+((Math.random()*2)|0), picks=new Set(); while(picks.size<how){ picks.add((Math.random()*37)|0); }
    const mults=[50,100,200,150,300];
    lightning=[...picks].map(n=>({n, x: mults[(Math.random()*mults.length)|0]}));
    lightBar.innerHTML=''; lightning.forEach(L=>{ const tag=document.createElement('div'); tag.className='lr-bolt lr-flash'; tag.textContent=`⚡ ${L.n} ×${L.x}`; lightBar.appendChild(tag); });
    flashFx.style.opacity='1'; flashFx.style.transition='opacity .18s ease'; setTimeout(()=>flashFx.style.opacity='0', 180);
    if(sfxOn){ zapSfx(); }
  }
  function finalize(code){
    reelReveal(codeBox, copyBtn, code, {spinMs:1100, slots:code.length, group:code});
    spinBtn.disabled=true; spun=true;
  }
  try{ const prior=localStorage.getItem(CLAIM_KEY); if(prior){ const saved = JSON.parse(prior).code||CODE_STD; codeBox.style.display='block'; codeBox.textContent=saved; copyBtn.style.display='inline-block'; spinBtn.disabled=true; spun=true; } }catch(e){}

  let lastTick = -1;
  document.getElementById('lr-copyBtn').addEventListener('click',()=>{ const t=codeBox.textContent.trim(); if(!t)return; navigator.clipboard.writeText(t).then(()=>{ copyBtn.textContent='Copied!'; setTimeout(()=>copyBtn.textContent='Copy Code',1200); if(sfxOn) copySfx(); });});

  document.getElementById('lr-spinBtn').addEventListener('click', ()=>{
    if(selected===null || spun) return; ensureLiveLock(); spun=true; spinBtn.disabled=true; chooseLightning();
    const winIdx=(Math.random()*37)|0; const targetDeg = 360 - (360/N)*winIdx - (360/(N*2));
    const turns = 6, total = turns*360 + targetDeg; const start=performance.now(), dur=4200;
    function anim(t){
      const p=Math.min(1,(t-start)/dur), e=1-Math.pow(1-p,3);
      const rot = e*total; slices.style.transform=`rotate(${rot}deg)`;
      const tickIndex = Math.floor((rot/360)*N)%N;
      if(sfxOn && tickIndex!==lastTick){ tickSfx(); lastTick=tickIndex; }
      if(p<1) requestAnimationFrame(anim); else{
        const lightningHit = lightning.some(l=>l.n===winIdx); const win = (selected===winIdx);
        let code='TRY-AGAIN-NEXT-TIME';
        if(win && lightningHit) code=CODE_XL; else if(win) code=CODE_STD;
        if(win){
          reelReveal(codeBox, copyBtn, code);
          try{ localStorage.setItem(CLAIM_KEY, JSON.stringify({code, ts:Date.now(), n:selected, winIdx, lightning})); }catch(e){}
          if(sfxOn) winSfx(); confettiBurst(innerWidth/2, innerHeight*.35);
        }else{
          reelReveal(codeBox, copyBtn, code);
          if(sfxOn) loseSfx();
        }
      }
    }
    requestAnimationFrame(anim);
  });
})();

/* ========= BLACKJACK ========= */
(function(){
  const CLAIM_KEY='live_blackjack_claimed_v1', CODE='LIVE-BJ-21';
  const dealerEl=document.getElementById('bj-dealerHand'), playerEl=document.getElementById('bj-playerHand');
  const dealerScore=document.getElementById('bj-dealerScore'), playerScore=document.getElementById('bj-playerScore'), statusEl=document.getElementById('bj-status');
  const dealBtn=document.getElementById('bj-dealBtn'), hitBtn=document.getElementById('bj-hitBtn'), standBtn=document.getElementById('bj-standBtn');
  const codeBox=document.getElementById('bj-codeBox'), copyBtn=document.getElementById('bj-copyBtn');
  let deck=[], dealer=[], player=[], inRound=false, dealerHidden=true;

  function makeDeck(){ const ranks=['A','2','3','4','5','6','7','8','9','10','J','Q','K']; const suits=['♠','♥','♦','♣']; const d=[]; suits.forEach(s=>ranks.forEach(r=>d.push({r,s}))); for(let i=d.length-1;i>0;i++){const j=(Math.random()*(i+1))|0; [d[i],d[j]]=[d[j],d[i]];} return d; }
  function value(hand){ let sum=0, aces=0; hand.forEach(c=>{ if(c.r==='A'){aces++; sum+=1} else if(['K','Q','J','10'].includes(c.r)){sum+=10}else sum+=Number(c.r) }); while(aces>0 && sum+10<=21){ sum+=10; aces--; } return sum; }
  function cardEl(c){ const el=document.createElement('div'); el.className='bj-card'; if(!c){ el.classList.add('bj-down'); el.textContent=''; return el; } el.innerHTML=`<div>${c.r}</div>`; return el; }
  function render(){ dealerEl.innerHTML=''; playerEl.innerHTML=''; dealer.forEach((c,i)=>dealerEl.appendChild(cardEl(i===0 && dealerHidden ? null : c))); player.forEach(c=>playerEl.appendChild(cardEl(c))); dealerScore.textContent = dealerHidden ? '??' : value(dealer); playerScore.textContent = value(player); }
  function animateDeal(toEl, card){
    const el = cardEl(card); el.style.transform='translateY(-10px) scale(.9)'; el.style.opacity='0';
    toEl.appendChild(el);
    requestAnimationFrame(()=>{
      el.style.transition='transform .18s ease, opacity .18s ease';
      el.style.transform='none'; el.style.opacity='1';
    });
    if(sfxOn) flipSfx();
  }
  function finalizeWin(){
    reelReveal(codeBox, copyBtn, CODE);
    try{ localStorage.setItem(CLAIM_KEY, JSON.stringify({code:CODE, ts:Date.now()})); }catch(e){}
    if(sfxOn) winSfx(); confettiBurst(innerWidth/2, innerHeight*.52);
  }
  try{ const prior=localStorage.getItem(CLAIM_KEY); if(prior){ const saved = JSON.parse(prior).code||CODE; codeBox.style.display='block'; codeBox.textContent=saved; copyBtn.style.display='inline-block'; dealBtn.disabled=true; } }catch(e){}

  function deal(){ ensureLiveLock(); deck = makeDeck(); dealer=[]; player=[]; dealerHidden=true; inRound=true; statusEl.textContent='Dealing...'; hitBtn.disabled=true; standBtn.disabled=true; dealBtn.disabled=true;
    player.push(deck.pop()); animateDeal(playerEl, player[0]);
    setTimeout(()=>{ dealer.push(deck.pop()); animateDeal(dealerEl, dealerHidden?null:dealer[0]); },180);
    setTimeout(()=>{ player.push(deck.pop()); animateDeal(playerEl, player[1]); },360);
    setTimeout(()=>{ dealer.push(deck.pop()); animateDeal(dealerEl, dealerHidden?null:dealer[1]); },540);
    setTimeout(()=>{ statusEl.textContent='Hit or Stand'; hitBtn.disabled=false; standBtn.disabled=false; render(); if(value(player)===21){ stand(); } }, 720);
    if(sfxOn) clickSfx();
  }
  function hit(){ if(!inRound) return; player.push(deck.pop()); render(); const last = playerEl.lastElementChild; last.classList.add('flip'); if(sfxOn) flipSfx(); if(value(player)>21){ statusEl.textContent='Bust! Dealer wins'; end(false); } }
  function stand(){ if(!inRound) return; dealerHidden=false; render();
    (function dealerDraw(){
      if(value(dealer)<17){ dealer.push(deck.pop()); render(); const last=dealerEl.lastElementChild; last.classList.add('flip'); if(sfxOn) flipSfx(); setTimeout(dealerDraw, 360); }
      else{
        const p=value(player), d=value(dealer);
        if(p===d){ statusEl.textContent='Push'; end(false,true); return; }
        const win=(d>21||p>d); statusEl.textContent = win ? 'You win!' : 'Dealer wins';
        end(win);
      }
    })();
  }
  function end(win,push=false){
    inRound=false; hitBtn.disabled=true; standBtn.disabled=true; dealBtn.disabled=false;
    if(win){ finalizeWin(); }
    else if(push){ /* allow redeal */ }
    else { reelReveal(codeBox, copyBtn, 'TRY-AGAIN-NEXT-TIME'); if(sfxOn) loseSfx(); }
  }
  document.getElementById('bj-dealBtn').addEventListener('click',deal);
  document.getElementById('bj-hitBtn').addEventListener('click',hit);
  document.getElementById('bj-standBtn').addEventListener('click',stand);
  document.getElementById('bj-copyBtn').addEventListener('click',()=>{ const t=codeBox.textContent.trim(); if(!t)return; navigator.clipboard.writeText(t).then(()=>{ document.getElementById('bj-copyBtn').textContent='Copied!'; setTimeout(()=>document.getElementById('bj-copyBtn').textContent='Copy Code',1200); if(sfxOn) copySfx(); });});
  render();
})();

/* ========= DRAGON TIGER ========= */
(function(){
  const CLAIM_KEY='live_dt_claimed_v1', CODE='LIVE-DRAGON-TIGER';
  const statusEl=document.getElementById('dt-status'), dEl=document.getElementById('dt-dCard'), tEl=document.getElementById('dt-tCard');
  const codeBox=document.getElementById('dt-codeBox'), copyBtn=document.getElementById('dt-copyBtn');
  const btnD=document.getElementById('dt-pick-d'), btnT=document.getElementById('dt-pick-t');
  const ranks=['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
  function draw(){ return ranks[(Math.random()*ranks.length)|0]; }
  function rv(r){ if(r==='A') return 1; if(['J','Q','K'].includes(r)) return 10+['J','Q','K'].indexOf(r)+1; return Number(r); }
  function finalizeWin(){ reelReveal(codeBox, copyBtn, CODE); try{ localStorage.setItem(CLAIM_KEY, JSON.stringify({code:CODE, ts:Date.now()})); }catch(e){} if(sfxOn) winSfx(); confettiBurst(innerWidth/2, innerHeight*.62); }
  try{ const prior=localStorage.getItem(CLAIM_KEY); if(prior){ const saved = JSON.parse(prior).code||CODE; codeBox.style.display='block'; codeBox.textContent=saved; copyBtn.style.display='inline-block'; } }catch(e){}

  function flip(el, val){
    el.classList.remove('dt-down');
    setTimeout(()=>{ el.classList.add('dt-flip'); el.textContent=val; if(sfxOn) flipSfx(); }, 60);
  }
  function go(side){
    btnD.disabled=true; btnT.disabled=true;
    ensureLiveLock();
    const d=draw(), t=draw();
    flip(dEl,d); flip(tEl,t);
    const dv=rv(d), tv=rv(t); const winSide = dv>tv ? 'dragon' : tv>dv ? 'tiger' : 'tie';
    if(winSide==='tie'){ statusEl.innerHTML='Tie — <span class="badge-lose">no voucher</span>'; reelReveal(codeBox, copyBtn, 'TRY-AGAIN-NEXT-TIME'); if(sfxOn) loseSfx(); return; }
    const win = (side===winSide);
    statusEl.innerHTML = win ? 'You win! <span class="badge-win">WIN</span>' : 'You chose the other side';
    if(win) finalizeWin(); else { reelReveal(codeBox, copyBtn, 'TRY-AGAIN-NEXT-TIME'); if(sfxOn) loseSfx(); }
  }
  btnD.addEventListener('click',()=>go('dragon'));
  btnT.addEventListener('click',()=>go('tiger'));
  copyBtn.addEventListener('click',()=>{ const t=codeBox.textContent.trim(); if(!t)return; navigator.clipboard.writeText(t).then(()=>{ copyBtn.textContent='Copied!'; setTimeout(()=>copyBtn.textContent='Copy Code',1200); if(sfxOn) copySfx(); });});
})();

/* ========= CRAPS ========= */
(function(){
  const CLAIM_KEY='live_craps_claimed_v1', CODE='LIVE-PASS-WIN';
  const betPass=document.getElementById('cr-betPass'), betDont=document.getElementById('cr-betDont'), rollBtn=document.getElementById('cr-rollBtn');
  const d1El=document.getElementById('cr-d1'), d2El=document.getElementById('cr-d2'), statusEl=document.getElementById('cr-status');
  const codeBox=document.getElementById('cr-codeBox'), copyBtn=document.getElementById('cr-copyBtn');
  let bet=null, point=null, resolved=false, comeOut=true;
  function finalizeWin(){ reelReveal(codeBox, copyBtn, CODE); try{ localStorage.setItem(CLAIM_KEY, JSON.stringify({code:CODE, ts:Date.now()})); }catch(e){} if(sfxOn) winSfx(); confettiBurst(innerWidth/2, innerHeight*.45); }
  try{ const prior=localStorage.getItem(CLAIM_KEY); if(prior){ const saved=JSON.parse(prior).code||CODE; codeBox.style.display='block'; codeBox.textContent=saved; copyBtn.style.display='inline-block'; rollBtn.disabled=true; } }catch(e){}

  function setBet(b){ if(bet) return; ensureLiveLock(); bet=b; rollBtn.disabled=false; statusEl.textContent='Tap Roll'; betPass.disabled=true; betDont.disabled=true; if(sfxOn) clickSfx(); }
  betPass.addEventListener('click',()=>setBet('pass'));
  betDont.addEventListener('click',()=>setBet('dont'));

  function roll(){
    if(resolved) return;
    d1El.classList.add('shake'); d2El.classList.add('shake'); if(sfxOn) diceSfx();
    setTimeout(()=>{
      d1El.classList.remove('shake'); d2El.classList.remove('shake');
      const a=1+((Math.random()*6)|0), b=1+((Math.random()*6)|0), s=a+b;
      d1El.textContent=a; d2El.textContent=b;
      if(comeOut){
        if(bet==='pass'){ if(s===7||s===11){ win(); return; } if([2,3,12].includes(s)){ lose(); return; } }
        else{ if([2,3].includes(s)){ win(); return; } if([7,11].includes(s)){ lose(); return; } if(s===12){ statusEl.textContent='Push on 12 — roll again'; return; } }
        point=s; comeOut=false; statusEl.textContent=`Point is ${point}. Roll until ${point} or 7.`;
      }else{
        if(s===point){ (bet==='pass') ? win() : lose(); }
        else if(s===7){ (bet==='pass') ? lose() : win(); }
        else{ statusEl.textContent=`Rolling… point ${point}`; }
      }
    }, 380);
  }
  function win(){ resolved=true; statusEl.innerHTML='You win! <span class="badge-win">WIN</span>'; finalizeWin(); rollBtn.disabled=true; }
  function lose(){ resolved=true; statusEl.textContent='Lost this round'; reelReveal(codeBox, copyBtn, 'TRY-AGAIN-NEXT-TIME'); rollBtn.disabled=true; if(sfxOn) loseSfx(); }
  rollBtn.addEventListener('click', roll);
  copyBtn.addEventListener('click',()=>{ const t=codeBox.textContent.trim(); if(!t)return; navigator.clipboard.writeText(t).then(()=>{ copyBtn.textContent='Copied!'; setTimeout(()=>copyBtn.textContent='Copy Code',1200); if(sfxOn) copySfx(); });});
})();

/* ========= BACCARAT SQUEEZE ========= */
(function(){
  const CLAIM_KEY='live_bac_squeeze_claimed_v1';
  const CODE_WIN='LIVE-BAC-WIN', CODE_LOSE='TRY-AGAIN-NEXT-TIME';
  const betPlayer=document.getElementById('bc-betPlayer'), betBanker=document.getElementById('bc-betBanker'), dealBtn=document.getElementById('bc-dealBtn');
  const pHand=document.getElementById('bc-pHand'), bHand=document.getElementById('bc-bHand'), pScore=document.getElementById('bc-pScore'), bScore=document.getElementById('bc-bScore');
  const result=document.getElementById('bc-result'), codeBox=document.getElementById('bc-codeBox'), copyBtn=document.getElementById('bc-copyBtn');

  const ranks=['A','2','3','4','5','6','7','8','9','10','J','Q','K'], suits=['♠','♥','♦','♣'];
  function rnd(a){ return a[(Math.random()*a.length)|0]; }
  function val(r){ if(r==='A')return 1; if(['10','J','Q','K'].includes(r)) return 0; return Number(r); }

  let bet=null, dealt=false, player=[], banker=[];
  function dealCard(){ return { r: rnd(ranks), s: rnd(suits), shown:false, peel:0 }; }
  function score(hand){ return (hand.reduce((t,c)=>t+val(c.r),0))%10; }

  function renderHand(container, hand){
    container.innerHTML='';
    hand.forEach((c)=>{
      const el=document.createElement('div'); el.className='bc-card'; if(c.shown) el.classList.add('show');
      el.innerHTML=`<div class="bc-face">${c.r}${c.s}</div>
        <div class="bc-cover"></div>
        <div class="bc-corners">
          <button class="bc-corner bc-tl" aria-label="Peel top-left"></button>
          <button class="bc-corner bc-tr" aria-label="Peel top-right"></button>
          <button class="bc-corner bc-bl" aria-label="Peel bottom-left"></button>
          <button class="bc-corner bc-br" aria-label="Peel bottom-right"></button>
        </div>`;
      el.querySelectorAll('.bc-corner').forEach(btn=>btn.addEventListener('click',()=>{
        if(c.shown) return;
        if(!btn.classList.contains('off')){
          btn.classList.add('off'); c.peel++;
          if(sfxOn) flipSfx();
          if(c.peel>=3){ c.shown=true; el.classList.add('show'); el.style.transform='rotateY(180deg)'; updateScores(); maybeFinish(); }
        }
      }));
      container.appendChild(el);
    });
  }
  function updateScores(){
    const ps = player.some(c=>c.shown) ? score(player) : '??';
    const bs = banker.some(c=>c.shown) ? score(banker) : '??';
    pScore.textContent = ps; bScore.textContent = bs;
  }
  function bothHandsShown(){ return player.every(c=>c.shown) && banker.every(c=>c.shown); }
  function maybeFinish(){
    if(!bothHandsShown()) return;
    const ps=score(player), bs=score(banker);
    const winner = ps>bs ? 'player' : bs>ps ? 'banker' : 'tie';
    if(winner==='tie'){ result.textContent='Tie — no voucher'; reelReveal(codeBox, copyBtn, CODE_LOSE); if(sfxOn) loseSfx(); return; }
    const win = (bet===winner);
    result.textContent = win ? 'You win!' : (winner==='player'?'Player wins':'Banker wins');
    if(win){
      reelReveal(codeBox, copyBtn, CODE_WIN);
      try{ localStorage.setItem(CLAIM_KEY, JSON.stringify({code:CODE_WIN, ts:Date.now()})); }catch(e){}
      if(sfxOn) winSfx(); confettiBurst(innerWidth/2, innerHeight*.58);
    } else {
      reelReveal(codeBox, copyBtn, CODE_LOSE);
      if(sfxOn) loseSfx();
    }
  }
  function choose(side){
    if(bet) return; ensureLiveLock();
    bet=side; dealBtn.disabled=false; result.textContent='Bet on ' + (side==='player'?'Player':'Banker') + ' — tap Deal';
    betPlayer.disabled=true; betBanker.disabled=true;
    if(sfxOn) clickSfx();
  }
  betPlayer.addEventListener('click', ()=> choose('player'));
  betBanker.addEventListener('click', ()=> choose('banker'));
  dealBtn.addEventListener('click', ()=>{ if(dealt) return; dealt=true; player=[dealCard(),dealCard()]; banker=[dealCard(),dealCard()]; renderHand(pHand,player); renderHand(bHand,banker); result.textContent='Squeeze to reveal'; });

  try{ const prior=localStorage.getItem(CLAIM_KEY); if(prior){ const saved=JSON.parse(prior).code||CODE_WIN; codeBox.style.display='block'; codeBox.textContent=saved; copyBtn.style.display='inline-block'; } }catch(e){}
  copyBtn.addEventListener('click',()=>{ const t=codeBox.textContent.trim(); if(!t)return; navigator.clipboard.writeText(t).then(()=>{ copyBtn.textContent='Copied!'; setTimeout(()=>copyBtn.textContent='Copy Code',1200); if(sfxOn) copySfx(); });});
})();
</script>
</body>
</html>
